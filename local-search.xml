<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>力扣757.设置交集大小至少为2</title>
    <link href="/2025/11/21/%E5%8A%9B%E6%89%A3757-%E8%AE%BE%E7%BD%AE%E4%BA%A4%E9%9B%86%E5%A4%A7%E5%B0%8F%E8%87%B3%E5%B0%91%E4%B8%BA2/"/>
    <url>/2025/11/21/%E5%8A%9B%E6%89%A3757-%E8%AE%BE%E7%BD%AE%E4%BA%A4%E9%9B%86%E5%A4%A7%E5%B0%8F%E8%87%B3%E5%B0%91%E4%B8%BA2/</url>
    
    <content type="html"><![CDATA[<h3 id="题面"><a href="#题面" class="headerlink" title="题面"></a>题面</h3><p>给定 $n (1\le n\le 10^5)$ 个闭区间 $[l_i, r_i] (1 \le l_i, r_i \le 10^8)$。需要构造一个整数集合 $S$，使得对每个区间 $[l_i, r_i]$，其中至少有 <strong>两个不同的整数</strong> 属于集合 $S$。求集合 $S$ 的最小可能大小。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>比较容易想到的是按照左端点升序排序，从后往前遍历，尽可能选靠前的位置，增大被多个区间共用的可能。然后考虑左端点相同的情况如何处理：比如 $[1,2]$ 和 $[1,5]$，发现在 $[3,5]$ 区间里的已有的点没有贡献，因为即便 $[3,5]$ 里有一个或者两个点，把 $[1,5]$ 满足了，$[1,2]$ 还是要放两个；反过来 $[1,2]$ 满足了则 $[1,5]$ 一定满足，所以应该将区间 $[l_i, r_i]$ 按照左端点升序，右端点降序排序。如下图所示：</p><img src="/2025/11/21/%E5%8A%9B%E6%89%A3757-%E8%AE%BE%E7%BD%AE%E4%BA%A4%E9%9B%86%E5%A4%A7%E5%B0%8F%E8%87%B3%E5%B0%91%E4%B8%BA2/image.png" class="" title="排序后的区间"><p>排序后，从后往前遍历每个区间。首先贪心地选取最后一个区间的 $l_n, l_n+1$ 两个位置，并记录为 $L, R$。向前遍历到倒数第二个区间时，检查:</p><ul><li>$L, R$ 都在 $[l_{n-1}, r_{n-1}]$ 范围内，跳过该区间；</li><li>只有 $L$ 在 $[l_{n-1}, r_{n-1}]$ 范围内，$R \gets L, L \gets l_{n-1}$，答案增加 1；</li><li>两者都不在范围内，$L&#x3D;l_{n-1}, R&#x3D;l_{n-1}+1$，答案增加 2。</li></ul><p>以此类推，$O(n)$ 时间复杂度得到答案。</p>]]></content>
    
    
    <categories>
      
      <category>做题</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>题解</tag>
      
      <tag>贪心</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>30分钟写一个天气查询网站</title>
    <link href="/2025/11/21/30%E5%88%86%E9%92%9F%E5%86%99%E4%B8%80%E4%B8%AA%E5%A4%A9%E6%B0%94%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99/"/>
    <url>/2025/11/21/30%E5%88%86%E9%92%9F%E5%86%99%E4%B8%80%E4%B8%AA%E5%A4%A9%E6%B0%94%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99/</url>
    
    <content type="html"><![CDATA[<p>本文使用 CGI 编写一个极其简单的天气查询网站，只需要实现一个 <code>index.html</code> 页面和一个 <code>weather.py</code> 脚本（调用高德天气 API）即可。CGI 是一种相对原始的协议，服务器接收形如 <code>&lt;path/to/script?parameters&gt;</code> 的请求时，每次创建一个新的进程运行该脚本响应。因为每次请求都要创建新进程，开销较大且资源浪费，因此在现代 Web 开发中已较少使用。CGI 的现代替代方案是 WSGI，它允许应用程序作为一个长期运行的进程或线程存在于内存中，服务器可以直接调用内存中的代码，因而提高了性能，Flask, Django 等主流 Web 框架都基于 WSGI 而非 CGI。本项目目录结构如图：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">weather-info/<br>└─cgi-bin/<br>    └─weather.py<br>└─index.html<br></code></pre></td></tr></table></figure><p>首先把前端页面写出来：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Weather Information<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 查询部分 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;city_input&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Show<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 展示部分，后续用 JS 替换掉 span 里的内容 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>City<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;city&quot;</span>&gt;</span>北京<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Weather<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;weather&quot;</span>&gt;</span>晴<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Temperature<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;temperature&quot;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> ℃ <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Humidity<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;humidity&quot;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>%<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>用 <code>python -m http.server --cgi 8000</code> 启动 CGI 服务器，在 <code>localhost:8000</code> 确认前端的效果无误后，接下来的任务是：</p><ol><li>取出 <code>&lt;input&gt;</code> 输入的 <code>city_input</code>，使用 CGI 协议启动后端脚本，查询对应城市并接收脚本返回的 JSON 信息，渲染到界面上。这一部分用 Javascript 写在 <code>&lt;script&gt;</code> 标签里。</li><li>后端 Python 脚本接收城市名参数，调用高德地图天气 API，整理 JSON 发回前端页面。</li></ol><p>我们先写后端脚本 <code>cgi-bin/weather.py</code>。根据高德开放平台的文档，注册账号，创建应用，可以拿到自己的 <code>API_KEY</code> 以及 API 链接 <code>https://restapi.amap.com/v3/weather/weatherInfo?city=&#123;adcode&#125;&amp;key=&#123;key&#125;</code>。</p><p>注意到 API 不支持直接按照城市名称查询，而是需要查询城市对应的 adcode。经过寻找，在 <a href="https://lbs.amap.com/api/webservice/download">这个页面</a> 下载城市编码表。表格给定了城市对应的 adcode，如图所示。我们只需实现一个 <code>get_adcode(city_name)</code> 函数，读取 xlsx 文件，查表并返回 adcode 即可。</p><img src="/2025/11/21/30%E5%88%86%E9%92%9F%E5%86%99%E4%B8%80%E4%B8%AA%E5%A4%A9%E6%B0%94%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99/adcode_table.png" class="" title="城市编码表"><p>我们把城市编码表 AMap_adcode_citycode.xlsx 放在 weather.py 的同级目录下，即 <code>cgi-bin/AMap_adcode_citycode.xlsx</code>，则 <code>get_adcode(city_name)</code> 如下：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> openyxl <span class="hljs-keyword">import</span> load_workbook<br><span class="hljs-keyword">import</span> pathlib<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_adcode</span>(<span class="hljs-params">city_name: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-comment"># 利用 pathlib 从 weather.py 的位置推出 xlsx 的位置</span><br>    script_dir = pathlib.Path(__file__).resolve().parent<br>    file_name = <span class="hljs-string">&#x27;AMap_adcode_citycode.xlsx&#x27;</span><br>    file_path = <span class="hljs-built_in">str</span>(script_dir / file_name)<br><br>    <span class="hljs-comment"># 加载 excel 文件</span><br>    workbook = load_workbook(file_path)<br>    sheet = workbook.active<br><br>    <span class="hljs-comment"># 遍历每一行（第一行为表头，从第二行开始）</span><br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sheet.iter_rows(min_row=<span class="hljs-number">2</span>):<br>        current_city = <span class="hljs-built_in">str</span>(row[<span class="hljs-number">0</span>].value).strip(<br>        ) <span class="hljs-keyword">if</span> row[<span class="hljs-number">0</span>].value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-comment"># current_city 均为行政区划全名，这里 current_city 包含 city_name 即认为匹配</span><br>        <span class="hljs-keyword">if</span> city_name.strip() <span class="hljs-keyword">in</span> current_city:<br>            arcode_value = row[<span class="hljs-number">1</span>].value<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(arcode_value).strip()<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><p>构建了城市名对 adcode 的映射后，我们先固定 <code>city_name</code>，查询一下吧：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py">city_name = <span class="hljs-string">&quot;东城区&quot;</span><br>API_KEY = <span class="hljs-string">&quot;your/api/key&quot;</span><br><br>api = <span class="hljs-string">&quot;https://restapi.amap.com/v3/weather/weatherInfo?city=&#123;adcode&#125;&amp;key=&#123;key&#125;&quot;</span><br>url = api.<span class="hljs-built_in">format</span>(adcode=get_adcode(city_name), key=API_KEY)<br><br>response = requests.get(url)<br>data = response.json()<br><span class="hljs-built_in">print</span>(data)<br></code></pre></td></tr></table></figure><p>打印出来的结果是：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;infocode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;lives&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;province&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;北京&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;东城区&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;adcode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;110101&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;weather&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;晴&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;temperature&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;13&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;winddirection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;南&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;windpower&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;≤3&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;humidity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;19&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;reporttime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-11-21 11:07:39&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;temperature_float&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;13.0&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;humidity_float&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;19.0&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>这就是完整的 JSON 返回值，我们不需要这么多信息，这里只取出城市、天气、温度、湿度打包发回前端：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py">responseData = &#123;<br>    <span class="hljs-string">&quot;city&quot;</span>: data[<span class="hljs-string">&quot;lives&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;city&quot;</span>], <span class="hljs-comment"># 注意加中间的 [0]，&quot;lives&quot; 是一个列表</span><br>    <span class="hljs-string">&quot;weather&quot;</span>: data[<span class="hljs-string">&quot;lives&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;weather&quot;</span>],<br>    <span class="hljs-string">&quot;temperature&quot;</span>: data[<span class="hljs-string">&quot;lives&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;temperature&quot;</span>],<br>    <span class="hljs-string">&quot;humidity&quot;</span>: data[<span class="hljs-string">&quot;lives&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;humidity&quot;</span>]<br>&#125;<br>jsonText = json.dumps(responseData, indent=<span class="hljs-number">4</span>)<br><span class="hljs-comment"># CGI 协议中，服务器将脚本的全部标准输出作为返回值，print 了就是发送了</span><br><span class="hljs-comment"># 因此需要特别注意输出格式，e.g. 先输出 header，不要输出调试语句等</span><br><span class="hljs-comment"># ——记得注释掉上上个代码块的 print(data)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Content-type: text/json\n&quot;</span>)<br><span class="hljs-built_in">print</span>(jsonText)<br></code></pre></td></tr></table></figure><p>回到前端，我们编写前后端交互和渲染页面的部分，主要实现 <code>showWeatherInfo()</code> 和 <code>updatePage()</code> 两个函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>(); <span class="hljs-comment">// 创建 request 对象，readyState == 0</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">showWeatherInfo</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 查询天气信息，绑定到 button 的 onclick 事件</span><br>  <span class="hljs-keyword">var</span> city_input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;city_input&quot;</span>).<span class="hljs-property">value</span>;<br>  <span class="hljs-comment">// 通过查询参数传递城市名称，后端使用 FieldStorage 获取参数</span><br>  <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">&quot;/cgi-bin/weather.py?city=&quot;</span> + city_input);<br>  request.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, url, <span class="hljs-literal">true</span>); <span class="hljs-comment">// open() 初始化 request 对象，readyState == 1</span><br>  request.<span class="hljs-property">onreadystatechange</span> = updatePage; <span class="hljs-comment">// updatePage 绑定到 onreadystatechange 事件，每次 readyState 改变都自动调用</span><br>  request.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 发送请求，收到 header 后 readyState == 2，接受 body 中 readyState == 3</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">updatePage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">readyState</span> == <span class="hljs-number">4</span>) &#123;<br>    <span class="hljs-comment">// 完全接受后 readyState == 4，可以安全使用</span><br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">status</span> == <span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-keyword">var</span> replyDoc = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(request.<span class="hljs-property">responseText</span>);<br>      <span class="hljs-comment">// city</span><br>      <span class="hljs-keyword">var</span> city = replyDoc.<span class="hljs-property">city</span>;<br>      <span class="hljs-keyword">var</span> cityElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;city&quot;</span>);<br>      cityElement.<span class="hljs-title function_">removeChild</span>(cityElement.<span class="hljs-property">firstChild</span>);<br>      cityElement.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(city));<br>      <span class="hljs-comment">// weather</span><br>      <span class="hljs-keyword">var</span> weather = replyDoc.<span class="hljs-property">weather</span>;<br>      <span class="hljs-keyword">var</span> weatherElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;weather&quot;</span>);<br>      weatherElement.<span class="hljs-title function_">removeChild</span>(weatherElement.<span class="hljs-property">firstChild</span>);<br>      weatherElement.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(weather));<br>      <span class="hljs-comment">// temperature</span><br>      <span class="hljs-keyword">var</span> temperature = replyDoc.<span class="hljs-property">temperature</span>;<br>      <span class="hljs-keyword">var</span> temperatureElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;temperature&quot;</span>);<br>      temperatureElement.<span class="hljs-title function_">removeChild</span>(temperatureElement.<span class="hljs-property">firstChild</span>);<br>      temperatureElement.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(temperature));<br>      <span class="hljs-comment">// humidity</span><br>      <span class="hljs-keyword">var</span> humidity = replyDoc.<span class="hljs-property">humidity</span>;<br>      <span class="hljs-keyword">var</span> humidityElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;humidity&quot;</span>);<br>      humidityElement.<span class="hljs-title function_">removeChild</span>(humidityElement.<span class="hljs-property">firstChild</span>);<br>      humidityElement.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(humidity));<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后把 <code>showWeatherInfo()</code> 绑定到 <code>&lt;button&gt;</code> 上，即 <code>&lt;button type=&quot;submit&quot; name=&quot;submit&quot; onclick=&quot;showWeatherInfo()&quot;&gt;Show&lt;/button&gt;</code>。这样，当我们点击按钮后，输入框中的文本 <code>东城区</code> 将会被以 <code>GET /cgi-bin/weather.py?city=东城区</code> 形式发往后端（如前所述，开启一个新的进程运行 weather.py 脚本，脚本通过 FieldStorage 接收参数并且打印到标准输出）。</p><p>现在，我们只需要补全 weather.py，让它拿到参数 <code>city_name</code> 即可——把 <code>city_name = &#39;东城区&#39;</code> 替换为：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">form = cgi.FieldStorage()<br>city_name = form.getvalue(<span class="hljs-string">&#x27;city&#x27;</span>, <span class="hljs-string">&#x27;东城区&#x27;</span>)<br></code></pre></td></tr></table></figure><p>一个简单的天气查询网站就开发完成了，效果如图所示：</p><img src="/2025/11/21/30%E5%88%86%E9%92%9F%E5%86%99%E4%B8%80%E4%B8%AA%E5%A4%A9%E6%B0%94%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99/weather.png" class="" title="查询结果">]]></content>
    
    
    <categories>
      
      <category>技术</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
